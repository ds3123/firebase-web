(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4259],{1081:function(e,t,s){Promise.resolve().then(s.bind(s,7461))},7461:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ej}});var a=s(7437),r=s(2265),l=s(8712),n=s(9213),c=s(2549),o=s(2169);let i=l.fC,d=l.xz,m=l.x8,u=l.h_,x=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...r,ref:t})});x.displayName=l.aV.displayName;let h=(0,n.j)("fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500",{variants:{side:{top:"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",bottom:"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom",left:"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm",right:"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm"}},defaultVariants:{side:"right"}}),p=r.forwardRef((e,t)=>{let{side:s="right",className:r,children:n,...i}=e;return(0,a.jsxs)(u,{children:[(0,a.jsx)(x,{}),(0,a.jsxs)(l.VY,{ref:t,className:(0,o.cn)(h({side:s}),r),...i,children:[n,(0,a.jsxs)(l.x8,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary",children:[(0,a.jsx)(c.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})});p.displayName=l.VY.displayName;let f=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.Dx,{ref:t,className:(0,o.cn)("text-lg font-semibold text-foreground",s),...r})});f.displayName=l.Dx.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(l.dk,{ref:t,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})}).displayName=l.dk.displayName;var j=s(575);function N(e){let{children:t,button_title:s,sheet_title:r,button_style:l}=e;return(0,a.jsxs)(i,{children:[(0,a.jsx)(d,{asChild:!0,children:(0,a.jsxs)(j.z,{className:"".concat(l),children:[" ",s," "]})}),(0,a.jsxs)(p,{className:"sm:max-w-[1000px] space-y-8",children:[(0,a.jsxs)(f,{className:"label",children:[" ",r,"  "]}),t]})]})}function _(e){let{button_title:t,sheet_title:s,query_fn:l,component:n}=e,[c,o]=(0,r.useState)(null);return(0,r.useEffect)(()=>{l().then(e=>{o(e)})},[l]),(0,a.jsx)(N,{button_title:t,sheet_title:s,button_style:"bg-indigo-100 text-indigo-600 hover:bg-indigo-200",children:n(c)})}var g=s(8110),y=s(1865),b=s(7256),w=s(6743);let v=(0,n.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Z=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(w.f,{ref:t,className:(0,o.cn)(v(),s),...r})});Z.displayName=w.f.displayName;let I=y.RV,C=r.createContext({}),R=e=>{let{...t}=e;return(0,a.jsx)(C.Provider,{value:{name:t.name},children:(0,a.jsx)(y.Qr,{...t})})},V=()=>{let e=r.useContext(C),t=r.useContext(F),{getFieldState:s,formState:a}=(0,y.Gc)(),l=s(e.name,a);if(!e)throw Error("useFormField should be used within <FormField>");let{id:n}=t;return{id:n,name:e.name,formItemId:"".concat(n,"-form-item"),formDescriptionId:"".concat(n,"-form-item-description"),formMessageId:"".concat(n,"-form-item-message"),...l}},F=r.createContext({}),k=r.forwardRef((e,t)=>{let{className:s,...l}=e,n=r.useId();return(0,a.jsx)(F.Provider,{value:{id:n},children:(0,a.jsx)("div",{ref:t,className:(0,o.cn)("space-y-2",s),...l})})});k.displayName="FormItem";let E=r.forwardRef((e,t)=>{let{className:s,...r}=e,{error:l,formItemId:n}=V();return(0,a.jsx)(Z,{ref:t,className:(0,o.cn)(l&&"text-destructive",s),htmlFor:n,...r})});E.displayName="FormLabel";let z=r.forwardRef((e,t)=>{let{...s}=e,{error:r,formItemId:l,formDescriptionId:n,formMessageId:c}=V();return(0,a.jsx)(b.g7,{ref:t,id:l,"aria-describedby":r?"".concat(n," ").concat(c):"".concat(n),"aria-invalid":!!r,...s})});z.displayName="FormControl",r.forwardRef((e,t)=>{let{className:s,...r}=e,{formDescriptionId:l}=V();return(0,a.jsx)("p",{ref:t,id:l,className:(0,o.cn)("text-sm text-muted-foreground",s),...r})}).displayName="FormDescription";let K=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e,{error:n,formMessageId:c}=V(),i=n?String(null==n?void 0:n.message):r;return i?(0,a.jsx)("p",{ref:t,id:c,className:(0,o.cn)("text-sm font-medium text-destructive",s),...l,children:i}):null});K.displayName="FormMessage";var A=s(2782),D=s(6337),J=s(3523),S=s(9224),Y=s(2442);let M=D.fC;D.ZA;let T=D.B4,B=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(D.xz,{ref:t,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",s),...l,children:[r,(0,a.jsx)(D.JO,{asChild:!0,children:(0,a.jsx)(J.Z,{className:"h-4 w-4 opacity-50"})})]})});B.displayName=D.xz.displayName;let O=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(D.u_,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(S.Z,{className:"h-4 w-4"})})});O.displayName=D.u_.displayName;let P=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(D.$G,{ref:t,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",s),...r,children:(0,a.jsx)(J.Z,{className:"h-4 w-4"})})});P.displayName=D.$G.displayName;let q=r.forwardRef((e,t)=>{let{className:s,children:r,position:l="popper",...n}=e;return(0,a.jsx)(D.h_,{children:(0,a.jsxs)(D.VY,{ref:t,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===l&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",s),position:l,...n,children:[(0,a.jsx)(O,{}),(0,a.jsx)(D.l_,{className:(0,o.cn)("p-1","popper"===l&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:r}),(0,a.jsx)(P,{})]})})});q.displayName=D.VY.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(D.__,{ref:t,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",s),...r})}).displayName=D.__.displayName;let G=r.forwardRef((e,t)=>{let{className:s,children:r,...l}=e;return(0,a.jsxs)(D.ck,{ref:t,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s),...l,children:[(0,a.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,a.jsx)(D.wU,{children:(0,a.jsx)(Y.Z,{className:"h-4 w-4"})})}),(0,a.jsx)(D.eT,{children:r})]})});function L(e){let{is_Valid:t}=e;return(0,a.jsxs)("div",{className:"text-center",children:[t&&(0,a.jsx)(m,{asChild:!0,children:(0,a.jsx)(j.z,{type:"submit",className:"bg-green-600",children:" 提交資料 "})}),t||(0,a.jsx)(j.z,{type:"submit",className:"bg-red-300",children:" 尚未完成表單 "})]})}G.displayName=D.ck.displayName,r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(D.Z0,{ref:t,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",s),...r})}).displayName=D.Z0.displayName;var U=s(4086),$=s(8439);let Q=async e=>{let t=(0,U.JU)($.Nx,"customers",e);return(await (0,U.QT)(t)).data()},X=async e=>{let t=(0,U.hJ)($.Nx,"customers"),s=(0,U.IO)(t,(0,U.ar)("customer_mobile","==",e));return(await (0,U.PL)(s)).docs.map(e=>({id:e.id,...e.data()}))},W=()=>{let[e,t]=(0,r.useState)(!1);return{is_Customer_Existing:e,handle_MobileChange:async e=>{t((await X(e)).length>0)}}};function H(e){let{data:t,edit_func:s,form_schema:r}=e,l=(0,y.cI)({resolver:(0,g.F)(r),defaultValues:t||{customer_name:"",customer_mobile:"",customer_telephone:"",customer_email:"",customer_line:"",customer_address:"",customer_id:"",customer_note:""}}),{is_Customer_Existing:n,handle_MobileChange:c}=W();async function o(e){s(e)}return(0,a.jsx)(I,{...l,children:(0,a.jsxs)("form",{onSubmit:l.handleSubmit(o),className:"space-y-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4 p-2",children:[(0,a.jsx)(R,{control:l.control,name:"customer_mobile",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1",children:[(0,a.jsxs)(E,{className:"relative",children:[(0,a.jsx)("span",{className:"required",children:" * "})," 手機號碼 \xa0",n?(0,a.jsx)("span",{className:"text-red-600 text-orange-400",children:" 此號碼 ( 客戶 ) 已存在 "}):""]}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{onChangeCapture:e=>c(e.currentTarget.value),placeholder:"輸入手機號碼 ( 可查詢客戶 ) ",...t})}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_name",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1",children:[(0,a.jsxs)(E,{className:"relative",children:[(0,a.jsx)("span",{className:"required",children:" * "})," 姓 名"]}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{placeholder:"輸入姓名",...t})}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_sex",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1",children:[(0,a.jsxs)(E,{className:"relative",children:[(0,a.jsx)("span",{className:"absolute -top-2 -left-2 text-red-600 font-extrabold",children:" * "})," 性 別"]}),(0,a.jsxs)(M,{onValueChange:t.onChange,defaultValue:t.value,children:[(0,a.jsx)(z,{children:(0,a.jsx)(B,{children:(0,a.jsx)(T,{placeholder:"請選擇"})})}),(0,a.jsxs)(q,{children:[(0,a.jsx)(G,{value:"男",children:"男"}),(0,a.jsx)(G,{value:"女",children:"女"})]})]}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_telephone",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1",children:[(0,a.jsx)(E,{className:"relative",children:"家用電話"}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{placeholder:"輸入家用電話",...t})}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_email",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1",children:[(0,a.jsx)(E,{children:" E-mail "}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{placeholder:"輸入 E-mail",...t})}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_line",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1",children:[(0,a.jsx)(E,{children:" Line "}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{placeholder:"輸入 Line",...t})}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_address",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1 col-span-2",children:[(0,a.jsx)(E,{children:" 通訊地址 "}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{placeholder:"輸入通訊地址",...t})}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_id",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1",children:[(0,a.jsx)(E,{children:" 身份證字號 "}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{placeholder:"輸入身份證字號",...t})}),(0,a.jsx)(K,{})]})}}),(0,a.jsx)(R,{control:l.control,name:"customer_note",render:e=>{let{field:t}=e;return(0,a.jsxs)(k,{className:"space-y-1 col-span-3",children:[(0,a.jsx)(E,{children:" 客戶備註 "}),(0,a.jsx)(z,{children:(0,a.jsx)(A.I,{placeholder:"輸入客戶備註",...t})}),(0,a.jsx)(K,{})]})}})]}),(0,a.jsx)(L,{is_Valid:l.formState.isValid})]})})}var ee=s(1424);let et=async e=>{try{await (0,U.oe)((0,U.JU)($.Nx,"customers",e)),(0,ee.A)("客戶刪除成功")}catch(e){(0,ee.A)("刪除客戶失敗 : ".concat(e))}};var es=s(4645),ea=s(7472);let er=async(e,t)=>{try{await (0,U.r7)((0,U.JU)($.Nx,"customers",e),t),(0,ee.A)("更新客戶成功")}catch(e){(0,ee.A)("更新客戶失敗 : ".concat(e))}};var el=s(2067),en=s.n(el),ec=s(4578);let eo=/^09[0-9]{8}$/,ei=ec.Ry({customer_name:ec.Z_().min(1,{message:"姓名需至少輸入一個字"}),customer_sex:ec.Km(["男","女"],{errorMap:()=>({message:"請選擇客戶性別"})}),customer_mobile:ec.Z_().regex(eo,{message:"手機格式 : 09 開頭 / 共 10 位數"}),customer_telephone:ec.Z_().optional(),customer_email:ec.Z_().optional(),customer_line:ec.Z_().optional(),customer_address:ec.Z_().optional(),customer_id:ec.Z_().optional(),customer_note:ec.Z_().optional()}).refine(async e=>{let{customer_mobile:t}=e;return!((await X(t)).length>0)},{path:["customer_mobile"],message:"此手機號碼已經存在於資料庫，無法新增"}),ed=ec.Ry({customer_name:ec.Z_().min(1,{message:"姓名需至少輸入一個字"}),customer_sex:ec.Km(["男","女"],{errorMap:()=>({message:"請選擇客戶性別"})}),customer_mobile:ec.Z_().regex(eo,{message:"手機格式 : 09 開頭 / 共 10 位數"}),customer_telephone:ec.Z_().optional(),customer_email:ec.Z_().optional(),customer_line:ec.Z_().optional(),customer_address:ec.Z_().optional(),customer_id:ec.Z_().optional(),customer_note:ec.Z_().optional()}),em=e=>t=>(0,a.jsx)(H,{data:t,edit_func:t=>er(e,t),form_schema:ed}),eu=[{accessorKey:"customer_name",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 客戶姓名 "}),cell:e=>{let{row:t}=e,s=t.original;return(0,a.jsx)(_,{button_title:s.customer_name,sheet_title:"修改客戶資料",query_fn:()=>Q(s.id),component:em(s.id)})}},{accessorKey:"customer_sex",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 客戶性別 "}),cell:e=>{let{row:t}=e;return(0,a.jsxs)("div",{className:"text-center",children:[" ",t.getValue("customer_sex")," "]})}},{accessorKey:"customer_mobile",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 手機號碼 "}),cell:e=>{let{row:t}=e;return(0,a.jsxs)("div",{className:"text-center",children:[" ",t.getValue("customer_mobile")," "]})}},{accessorKey:"customer_telephone",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 家用電話 "}),cell:e=>{let{row:t}=e;return(0,a.jsxs)("div",{className:"text-center",children:[" ",t.getValue("customer_telephone")," "]})}},{accessorKey:"customer_pets",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 客戶寵物 "})},{accessorKey:"customer_address",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 通訊地址 "}),cell:e=>{let{row:t}=e;return t.getValue("customer_address")}},{accessorKey:"customer_history",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 消費歷史 "}),cell:e=>{let{row:t}=e;return(0,a.jsx)("div",{className:"text-center",children:"檢視"})}},{accessorKey:"timestamp",header:()=>(0,a.jsx)("div",{className:"text-center",children:" 建檔日期 "}),cell:e=>{let{row:t}=e,s=t.getValue("timestamp");return(0,a.jsx)("div",{className:"text-center",children:s?en()(s.toDate()).format("YYYY-MM-DD"):""})}},{id:"actions",header:"其 他",cell:e=>{let{row:t}=e,s=t.original;return(0,a.jsxs)(es.h_,{children:[(0,a.jsx)(es.$F,{asChild:!0,children:(0,a.jsx)(j.z,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,a.jsx)(ea.Z,{className:"h-4 w-4"})})}),(0,a.jsxs)(es.AW,{align:"end",children:[(0,a.jsx)(es.Ju,{children:"  客戶資料相關操作 "}),(0,a.jsx)(es.VD,{}),(0,a.jsx)(es.Xi,{className:"cursor-pointer",onClick:()=>{window.confirm("確認要刪除此筆資料？")&&et(s.id)},children:(0,a.jsxs)("span",{className:"text-red-600 ml-1",children:["  刪除客戶 :  ",(0,a.jsxs)("b",{children:[" ",s.customer_name," "]})," "]})})]})]})}}];function ex(e){let{button_title:t,sheet_title:s,component:r}=e;return(0,a.jsx)(N,{button_title:t,sheet_title:s,children:r})}var eh=s(1977);let ep=()=>{let[e,t]=(0,r.useState)([]);return(0,r.useEffect)(()=>{let e=(0,U.IO)((0,U.hJ)($.Nx,"customers"),(0,U.Xo)("timestamp","desc")),s=(0,U.cf)(e,e=>{t(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>s()},[]),e},ef=async e=>{try{e.timestamp=(0,U.Bt)(),await (0,U.ET)((0,U.hJ)($.Nx,"customers"),e),(0,ee.A)("新增客戶成功")}catch(e){(0,ee.A)("新增客戶失敗 : ".concat(e))}};function ej(){let e=ep();return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"text-right",children:(0,a.jsx)(ex,{button_title:"新增客戶",sheet_title:"新增客戶",component:(0,a.jsx)(H,{edit_func:e=>ef(e),form_schema:ei})})}),(0,a.jsx)(eh.DataTable,{columns:eu,data:e,filter:["customer_name","customer_mobile"]})]})}},8439:function(e,t,s){"use strict";s.d(t,{Nx:function(){return o}});var a=s(994),r=s(4086),l=s(9584);let n={apiKey:s(2601).env.FIREBASE_API_KEY,authDomain:"web-api-f5107.firebaseapp.com",projectId:"web-api-f5107",storageBucket:"web-api-f5107.appspot.com",messagingSenderId:"19499484520",appId:"1:19499484520:web:4fd05ea09b3f5fcd0e42dd",measurementId:"G-63JZSBJTCE"},c=(0,a.C6)().length?(0,a.Mq)():(0,a.ZF)(n),o=(0,r.ad)(c);(0,l.cF)(c)}},function(e){e.O(0,[4358,6990,167,845,2790,3943,1424,8158,1977,2971,4938,1744],function(){return e(e.s=1081)}),_N_E=e.O()}]);